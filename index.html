<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–µ—Å—Ç –Ω–∞ –Ω–∞–≥–æ–ª–æ—Å–∏</title>
<style>
  :root {
    --bg-color: #2e2b3a;
    --text-color: #d7cde4;
    --accent-color: #827081;
    --correct-color: #8BC34A;
    --wrong-color: #F44336;
    --hover-color: #aea3b0;
    --letter-bg: #3e3a50;
    --vowel-color: #4a4357;
  }
  body.day {
    --bg-color: #e7e6f7;
    --text-color: #4a3b5b;
    --accent-color: #827081;
    --hover-color: #aea3b0;
    --letter-bg: #e3d0d8;
    --vowel-color: #c4b9d6;
  }
  body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    transition: background-color 0.5s, color 0.5s;
    overflow: hidden;
    padding: 20px;
  }
  .word-container {
    position: relative;
    height: 100px;
    width: 100%;
    overflow: hidden;
    margin-bottom: 15px;
  }
  .word {
    font-size: 2rem;
    text-align: center;
    position: absolute;
    width: 100%;
    opacity: 0;
    transform: translateY(100%);
    transition: transform 0.3s ease-out, opacity 0.3s ease;
  }
  .word.show {
    opacity: 1;
    transform: translateY(0);
  }
  .word-note {
    font-size: 0.9rem;
    color: var(--hover-color);
    text-align: center;
    margin-bottom: 5px;
  }
  .word-hint {
    font-size: 0.9rem;
    color: var(--hover-color);
    text-align: center;
    margin-top: 5px;
    font-style: italic;
  }
  .letter {
    padding: 8px;
    margin: 3px;
    border-radius: 10px;
    background-color: var(--letter-bg);
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: inline-block;
    font-size: 1.5rem;
  }
  .letter.vowel {
    background-color: var(--vowel-color);
  }
  .letter:hover {
    background-color: var(--hover-color);
    transform: scale(1.1);
  }
  .letter.correct {
    background-color: var(--correct-color);
    color: white;
  }
  .letter.wrong {
    background-color: var(--wrong-color);
    color: white;
  }
  .letter.non-vowel {
    cursor: default;
    opacity: 0.9;
  }
  .info {
    margin-top: 15px;
    font-size: 1rem;
    text-align: center;
  }
  .buttons {
    margin-top: 15px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
  }
  .btn {
    padding: 8px 16px;
    background-color: var(--accent-color);
    color: white;
    border: none;
    border-radius: 18px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    flex: 1;
    max-width: 140px;
  }
  .btn:hover {
    background-color: var(--hover-color);
  }
  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 100;
  }
  .modal.show {
    display: flex;
    opacity: 1;
  }
  .modal-content {
    background: var(--letter-bg);
    padding: 20px;
    border-radius: 12px;
    width: 80%;
    max-width: 400px;
    color: var(--text-color);
    text-align: center;
    transform: translateY(-20px);
    transition: transform 0.3s ease;
  }
  .modal.show .modal-content {
    transform: translateY(0);
  }
  .theme-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.8rem;
    cursor: pointer;
  }

  @media (min-width: 600px) {
    .word-container { height: 120px; }
    .word { font-size: 3rem; }
    .letter { 
      font-size: 2rem;
      padding: 10px;
      margin: 5px;
    }
    .word-note, .word-hint { font-size: 1rem; }
    .info { font-size: 1.2rem; }
    .btn {
      padding: 10px 20px;
      font-size: 1rem;
      max-width: 150px;
    }
  }
</style>
</head>
<body>

<div class="theme-toggle" id="themeToggle">üåô</div>

<div class="word-container">
  <div class="word-note" id="wordNote"></div>
  <div class="word" id="word"></div>
  <div class="word-hint" id="wordHint"></div>
</div>

<div class="info">
  <div id="streak">–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –Ω–∞–≥–æ–ª–æ—Å—ñ–≤ –ø—ñ–¥—Ä—è–¥: 0</div>
  <div id="mistakes">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫: 0/3</div>
  <div id="record">–î–æ —Ä–µ–∫–æ—Ä–¥—É –∑–∞–ª–∏—à–∏–ª–æ—Å—å: 0</div>
</div>

<div class="buttons">
  <button class="btn" id="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
  <button class="btn" id="restart">–ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
  <button class="btn" id="next" style="display:none;">–ù–∞—Å—Ç—É–ø–Ω–µ —Å–ª–æ–≤–æ</button>
</div>

<div class="modal" id="statsModal">
  <div class="modal-content">
    <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <div id="statsContent"></div>
    <button class="btn" onclick="closeStats()">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>
</div>

<script>
const wordsWithStress = [
  "–∞–≥—Ä–æ–Ω–û–º—ñ—è", "–∞–ª—Ñ–ê–≤–Ü—Ç", "–ê—Ä–∫—É—à–∏–∫", "–∞—Å–∏–º–µ—Ç—Ä–Ü—è",
  "–±–∞–≥–∞—Ç–æ—Ä–∞–∑–û–≤–∏–π", "–±–µ–∑–ø—Ä–∏–Ω—Ü–ò–ø–Ω–∏–π", "–±–ï—à–∫–µ—Ç", "–±–ª–ê–≥–æ–≤—ñ—Å—Ç",
  "–±–ª–∏–∑—å–∫–ò–π", "–±–æ–ª–æ—Ç–ò—Å—Ç–∏–π", "–±–æ—Ä–û–¥–∞–≤–∫–∞", "–±–æ—Å–û–Ω—ñ–∂", "–±–æ–Ø–∑–Ω—å",
  "–±—É—Ä—à—Ç–∏–Ω–û–≤–∏–π", "–±—é–ª–µ—Ç–ï–Ω—å", "–≤–ê–≥–∏(—É –º–Ω–æ–∂–∏–Ω—ñ)", "–≤–∞–Ω—Ç–∞–∂–Ü–≤–∫–∞",
  "–≤–µ—Å–Ω–Ø–Ω–ò–π", "–≤–ò–≥–æ–¥–∞(–∫–æ—Ä–∏—Å—Ç—å)", "–≤–∏–≥–û–¥–∞(–∑—Ä—É—á–Ω—ñ—Å—Ç—å)",
  "–≤–∏–¥–ê–Ω–Ω—è", "–≤–∏–∑–≤–û–ª—å–Ω–∏–π", "–≤–∏–º–û–≥–∞", "–≤–ò–ø–∞–¥–æ–∫", "–≤–∏—Ä–ê–∑–Ω–∏–π",
  "–≤–ò—Å—ñ—Ç–∏", "–≤–ò—Ç—Ä–∞—Ç–∞", "–≤–∏—à–ò–≤–∞–Ω–∏–π", "–≤—ñ–¥–≤–µ–∑—Ç–ò", "–≤—ñ–¥–≤–µ—Å—Ç–ò",
  "–≤–Ü–¥–≥–æ–º—ñ–Ω", "–≤—ñ–¥–Ω–µ—Å—Ç–ò", "–≤–Ü–¥–æ–º—ñ—Å—Ç—å(—Å–ø–∏—Å–æ–∫)", "–≤—ñ–¥–û–º—ñ—Å—Ç—å(–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –¥–∞–Ω—ñ, –ø–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å)",
  "–≤–Ü—Ä—à—ñ", "–≤—ñ—Ä—à–æ–≤–ò–π", "–≤—ñ—Ç—á–ò–º", "–≥–∞–ª—å–º–û", "–≥–ê–ª—å–º–∞", "–≥–ª—è–¥–ê—á",
  "–≥–æ—Ä–æ—à–ò–Ω–∞", "–≥—Ä–∞–±–ª–Ü", "–≥—É—Ä—Ç–û–∂–∏—Ç–æ–∫", "–¥–∞–Ω–ò–Ω–∞", "–¥–ê–Ω–æ",
  "–¥–µ—Ü–∏–º–ï—Ç—Ä", "–¥–ï—â–∏—Ü—è", "–¥–µ-–Æ—Ä–µ", "–¥–∂–µ—Ä–µ–ª–û", "–¥–ò–≤–ª—è—á–∏—Å—å",
  "–¥–∏—á–ê–≤—ñ—Ç–∏", "–¥—ñ–∞–ª–û–≥", "–¥–æ–±–æ–≤–ò–π", "–¥–æ–±–£—Ç–æ–∫", "–¥–æ–≤–µ–∑—Ç–ò",
  "–¥–æ–≤–µ—Å—Ç–ò", "–¥–æ–≤–Ü–¥–Ω–∏–∫", "–¥–û–≥–º–∞—Ç", "–¥–æ–Ω–µ—Å—Ç–ò", "–¥–û–Ω—å–∫–∞",
  "–¥–æ—á–∫–ê", "–¥—Ä–û–≤–∞", "–µ–∫—Å–ø–ï—Ä—Ç", "—î—Ä–µ—Ç–ò–∫", "–∂–∞–ª—é–∑–Ü",
  "–∑–∞–≤–¥–ê–Ω–Ω—è", "–∑–∞–≤–µ–∑—Ç–ò", "–∑–∞–≤–µ—Å—Ç–ò", "–∑–ê–≤–∂–¥–∏", "–∑–∞–≤—á–∞—Å–£",
  "–∑–ê–≥–∞–¥–∫–∞", "–∑–∞—ñ—Ä–∂–ê–≤—ñ–ª–∏–π", "–∑–∞—ñ—Ä–∂–ê–≤—ñ—Ç–∏", "–∑–∞–∫—ñ–Ω—á–ò—Ç–∏", "–∑–ê–∫–ª–∞–¥–∫–∞(—É –∫–Ω–∏–∑—ñ)",
  "–∑–ê–∫—Ä—É—Ç–∫–∞", "–∑–∞–ª–∏—à–ò—Ç–∏", "–∑–∞–º–Ü–∂–Ω—è", "–∑–∞–Ω–µ—Å—Ç–ò", "–∑–ê–ø–æ–Ω–∫–∞",
  "–∑–∞—Ä–æ–±–Ü—Ç–æ–∫", "–∑–ê—Å—Ç–∞–≤–∫–∞", "–∑–ê—Å—Ç—ñ–±–∫–∞", "–∑–∞—Å—Ç–û–ø–æ—Ä–∏—Ç–∏", "–∑–≤–ò—Å–æ–∫–∞",
  "–∑–¥–ê–ª–µ–∫–∞", "–∑—ñ–±—Ä–ê–Ω–Ω—è", "–∑–æ–±—Ä–∞–∑–ò—Ç–∏", "–∑–û–∑–ª–∞", "–∑—Ä–ê–Ω–Ω—è",
  "–∑—Ä–£—á–Ω–∏–π", "–∑—É–±–û–∂—ñ–Ω–Ω—è", "—ñ–Ω–¥–£—Å—Ç—Ä—ñ—è", "–∫–ê–º–±–∞–ª–∞", "–∫–∞—Ç–∞–ª–û–≥",
  "–∫–≤–∞—Ä—Ç–ê–ª", "–∫–ò—à–∫–∞", "–∫—ñ–ª–æ–º–ï—Ç—Ä", "–∫—ñ–Ω—á–ò—Ç–∏", "–∫–û–ª–µ—Å–æ",
  "–∫–û–ª—ñ—è", "–∫–û–ø—á–µ–Ω–∏–π(–¥—ñ—î–ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫)", "–∫–æ–ø—á–ï–Ω–∏–π(–ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫)", "–∫–æ—Ä–ò—Å–Ω–∏–π",
  "–∫–û—Å–∏–π", "–∫–æ—Ç—Ä–ò–π", "–∫—Ä–∏—Ü–ï–≤–∏–π", "–∫—Ä–û—ó—Ç–∏", "–∫—Ä–æ–ø–∏–≤–ê",
  "–∫—É–ª—ñ–Ω–ê—Ä—ñ—è", "–∫–£—Ä—è—Ç–∏–Ω–∞", "–ª–ê—Ç–µ", "–ª–∏—Å—Ç–æ–ø–ê–¥", "–ª—ñ—Ç–û–ø–∏—Å",
  "–ª–Æ—Å—Ç—Ä–æ", "–º–ê–±–£—Ç—å", "–º–∞–≥—ñ—Å—Ç–ï—Ä—Å—å–∫–∏–π", "–º–ê—Ä–∫–µ—Ç–∏–Ω–≥", "–º–µ—Ä–ï–∂–∞",
  "–º–µ—Ç–∞–ª–£—Ä–≥—ñ—è", "–º—ñ–ª—ñ–º–ï—Ç—Ä", "–Ω–∞–≤—á–ê–Ω–Ω—è", "–Ω–∞–Ω–µ—Å—Ç–ò", "–Ω–∞–ø–Ü–π",
  "–Ω–ê—Å–∫—Ä—ñ–∑–Ω–∏–π", "–Ω–ê—á–∏–Ω–∫–∞", "–Ω–µ–Ω–ê–≤–∏–¥—ñ—Ç–∏", "–Ω–µ–Ω–ê–≤–∏—Å–Ω–∏–π", "–Ω–µ–Ω–ê–≤–∏—Å—Ç—å",
  "–Ω–µ—Å—Ç–ò", "–Ω–Ü–∑–¥—Ä—è", "–Ω–æ–≤–ò–π", "–æ–±—ñ—Ü–Ø–Ω–∫–∞", "–æ–±—Ä–ê–Ω–Ω—è",
  "–æ–±—Ä–£—á(—ñ–º–µ–Ω–Ω–∏–∫)", "–æ–¥–∏–Ω–ê–¥—Ü—è—Ç—å", "–æ–¥–Ω–æ—Ä–∞–∑–û–≤–∏–π", "–æ–∑–Ω–ê–∫–∞", "–û–ª–µ–Ω—å",
  "–æ–ø—Ç–û–≤–∏–π", "–æ—Å–µ—Ç–ï—Ä", "–æ—Ç–ê–º–∞–Ω", "–û—Ü–µ—Ç", "–ø–∞–≤–ò—á",
  "–ø–∞—Ä—Ç–ï—Ä", "–ø–ï–∫–∞—Ä—Å—å–∫–∏–π", "–ø–µ—Ä–µ–≤–µ–∑—Ç–ò", "–ø–µ—Ä–µ–≤–µ—Å—Ç–ò", "–ø–µ—Ä–ï–∫–∏—Å",
  "–ø–µ—Ä–µ–ª–Ø–∫", "–ø–µ—Ä–µ–Ω–µ—Å—Ç–ò", "–ø–µ—Ä–ï–ø–∞–¥", "–ø–µ—Ä–ï–ø–∏—Å", "–ø—ñ–∞–ª–ê",
  "–ø–Ü–¥–¥–∞–Ω–∏–π(–¥—ñ—î–ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫)", "–ø—ñ–¥–¥–ê–Ω–∏–π(—ñ–º–µ–Ω–Ω–∏–∫, —ñ—Å—Ç–æ—Ç–∞)", "–ø–Ü–¥–ª—ñ—Ç–∫–æ–≤–∏–π", "–ø—ñ–∑–Ω–ê–Ω–Ω—è", "–ø—ñ—Ç–Ω–ò–π",
  "–ø—ñ—Ü–ï—Ä—ñ—è", "–ø–û–¥—Ä—É–≥–∞", "–ø–û–∑–Ω–∞—á–∫–∞", "–ø–û–º–ò–ª–∫–∞", "–ø–æ–º–Ü—â–∏–∫",
  "–ø–æ–º–û–≤—á–∞—Ç–∏", "–ø–æ–Ω–Ø—Ç—Ç—è", "–ø–æ—Ä—è–¥–∫–û–≤–∏–π", "–ø–æ—Å–µ—Ä–ï–¥–∏–Ω—ñ", "–ø—Ä–∏–≤–µ–∑—Ç–ò",
  "–ø—Ä–∏–≤–µ—Å—Ç–ò", "–ø—Ä–ò–º–æ—Ä–æ–∑–æ–∫", "–ø—Ä–∏–Ω–µ—Å—Ç–ò", "–ø—Ä–ò—á—ñ–ø", "–ø—Ä–û–¥—ñ–ª",
  "–ø—Ä–æ–º–Ü–∂–æ–∫", "–ø—Å–µ–≤–¥–æ–Ω–Ü–º", "—Ä–ê–∑–æ–º", "—Ä–ï–º—ñ–Ω—å(–ø–æ—è—Å)", "—Ä–ï—à–µ—Ç–æ",
  "—Ä–ò–Ω–∫–æ–≤–∏–π", "—Ä—ñ–≤–Ω–ò–Ω–∞", "—Ä–æ–∑–¥—Ä—ñ–±–Ω–ò–π", "—Ä–û–∑–ø—ñ—Ä–∫–∞", "—Ä—É–∫–û–ø–∏—Å",
  "—Ä—É—Å–ª–û", "—Å–∞–Ω—Ç–∏–º–ï—Ç—Ä", "—Å–≤–ï—Ä–¥–ª–æ", "—Å–µ—Ä–ï–¥–∏–Ω–∞", "—Å–ï—á–∞",
  "—Å–∏–º–µ—Ç—Ä–Ü—è", "—Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–ê—Ä—Å—å–∫–∏–π", "—Å—ñ–º–¥–µ—Å–Ø—Ç", "—Å–ª–ò–Ω–∞", "—Å–æ–ª–æ–º–ò–Ω–∫–∞",
  "—Å—Ç–ê—Ç—É—è", "—Å—Ç–æ–≤—ñ–¥—Å–û—Ç–∫–æ–≤–∏–π", "—Å—Ç—Ä–∏–±–ê—Ç–∏", "—Ç–µ–∫—Å—Ç–æ–≤–ò–π", "—Ç–µ—á—ñ–Ø",
  "—Ç–ò–≥—Ä–æ–≤–∏–π", "—Ç–∏—Å–û–≤–∏–π", "—Ç—ñ–º'—è–Ω–ò–π", "—Ç—Ä–∞–≤–µ—Å—Ç–Ü—è", "—Ç—Ä–∏–∑–£–±",
  "—Ç–£–ª—É–±", "—É–∫—Ä–∞–á–Ω—Å—å–∫–∏–π", "—É–ø–æ–¥–û–±–∞–Ω–Ω—è", "—É—Ä–æ—á–ò—Å—Ç–∏–π", "—É—Å–µ—Ä–ï–¥–∏–Ω—ñ",
  "—Ñ–∞—Ä—Ç–£—Ö", "—Ñ–∞—Ö–æ–≤–ò–π", "—Ñ–µ–Ω–û–º–µ–Ω", "—Ñ–û–ª—å–≥–∞", "—Ñ–û—Ä–∑–∞—Ü",
  "—Ö–ê–æ—Å(—É –º—ñ—Ñ–æ–ª–æ–≥—ñ—ó: —Å—Ç–∏—Ö—ñ—è)", "—Ö–∞–û—Å(–±–µ–∑–ª–∞–¥)", "—Ü–ê—Ä–∏–Ω–∞", "—Ü–µ–º–ï–Ω—Ç", "—Ü–ï–Ω—Ç–Ω–µ—Ä",
  "—Ü—ñ–Ω–Ω–ò–∫", "—á–∞—Ä—ñ–≤–Ω–ò–π", "—á–µ—Ä–≥–æ–≤–ò–π", "—á–∏—Ç–ê–Ω–Ω—è", "—á–æ—Ä–Ω–û–∑–µ–º",
  "—á–æ—Ä–Ω–û—Å–ª–∏–≤", "—á–æ—Ç–∏—Ä–Ω–ê–¥—Ü—è—Ç—å", "—à–ª—è—Ö–æ–ø—Ä–æ–≤–Ü–¥", "—à–æ–≤–∫–û–≤–∏–π", "—à–æ—Ñ–ï—Ä",
  "—â–ï–ª–µ–ø–∞", "—â–ò–ø—Ü—ñ", "—â–æ–¥–æ–±–æ–≤–ò–π", "—è—Ä–º–∞—Ä–∫–û–≤–∏–π"
];

const vowels = new Set(['–∞', '–µ', '—î', '–∏', '—ñ', '—ó', '–æ', '—É', '—é', '—è']);
const doubleStressWords = new Set(["–ø–û–º–ò–ª–∫–∞", "–ø–æ–º–Ü—â–∏–∫"]);

// Load saved progress
let savedData = JSON.parse(localStorage.getItem('accentGameData')) || {};
let availableWords = [...wordsWithStress];
let usedWords = [];
let mistakeWords = savedData.mistakeWords || {};
let streak = savedData.streak || 0;
let bestStreak = savedData.bestStreak || 0;
let mistakes = savedData.mistakes || 0;
let totalCorrect = savedData.totalCorrect || 0;
let totalMistakes = savedData.totalMistakes || 0;
let currentWord = '';
let stressedIndices = [];
let selectedCount = 0;
let requiredSelections = 1;

function saveProgress() {
  const gameData = {
    mistakeWords,
    streak,
    bestStreak,
    mistakes,
    totalCorrect,
    totalMistakes,
    theme: document.body.classList.contains('day') ? 'day' : 'night'
  };
  localStorage.setItem('accentGameData', JSON.stringify(gameData));
}

function chooseWord() {
  if (availableWords.length === 0) {
    alert("–í—Å—ñ —Å–ª–æ–≤–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ! –ü–æ—á–∏–Ω–∞—î–º–æ –Ω–æ–≤—É –≥—Ä—É.");
    restartGame();
    return;
  }
  
  const wordRaw = availableWords.splice(Math.floor(Math.random() * availableWords.length), 1)[0];
  usedWords.push(wordRaw);
  
  // Extract note if present
  const noteMatch = wordRaw.match(/\(([^)]+)\)/);
  const note = noteMatch ? noteMatch[1] : '';
  currentWord = wordRaw.replace(/\([^)]+\)/, '').toLowerCase();
  
  // Find stress positions (uppercase letters)
  const wordWithStress = wordRaw.replace(/\([^)]+\)/, '');
  stressedIndices = [...wordWithStress]
    .map((c, i) => c === c.toUpperCase() && /[–ê-–Ø–Ü–á–Ñ“ê]/.test(c) ? i : -1)
    .filter(i => i !== -1);
  
  // Check if this is a word requiring two stresses
  requiredSelections = doubleStressWords.has(wordWithStress) ? 2 : 1;
  
  displayWord(note);
}

function displayWord(note = '') {
  const container = document.getElementById('word');
  const noteElement = document.getElementById('wordNote');
  const hintElement = document.getElementById('wordHint');
  
  container.classList.remove('show');
  noteElement.textContent = note;
  hintElement.textContent = requiredSelections === 2 ? "–û–±–µ—Ä—ñ—Ç—å –¥–≤–∞ –Ω–∞–≥–æ–ª–æ—Å–∏" : "";
  
  selectedCount = 0;
  
  setTimeout(() => {
    container.innerHTML = '';
    [...currentWord].forEach((letter, index) => {
      const span = document.createElement('span');
      span.className = 'letter';
      span.textContent = letter;
      
      if (vowels.has(letter.toLowerCase())) {
        span.classList.add('vowel');
        span.onclick = () => handleChoice(index, span);
      } else {
        span.classList.add('non-vowel');
      }
      
      container.appendChild(span);
    });
    setTimeout(() => container.classList.add('show'), 50);
  }, 200);
  
  document.getElementById('next').style.display = 'none';
}

function handleChoice(index, span) {
  const letters = document.querySelectorAll('.letter');
  
  if (span.classList.contains('correct') || span.classList.contains('wrong')) {
    return; // Already selected this letter
  }

  if (stressedIndices.includes(index)) {
    span.classList.add('correct');
    selectedCount++;
    
    if (selectedCount === requiredSelections) {
      letters.forEach(l => {
        if (vowels.has(l.textContent.toLowerCase())) {
          l.onclick = null;
        }
      });
      
      streak++;
      totalCorrect++;
      
      if (streak > bestStreak) {
        bestStreak = streak;
      }
    }
  } else {
    span.classList.add('wrong');
    stressedIndices.forEach(i => letters[i].classList.add('correct'));
    letters.forEach(l => {
      if (vowels.has(l.textContent.toLowerCase())) {
        l.onclick = null;
      }
    });
    streak = 0;
    mistakes++;
    totalMistakes++;
    mistakeWords[currentWord] = (mistakeWords[currentWord] || 0) + 1;
  }

  updateInfo();
  saveProgress();

  if (mistakes >= 3) {
    setTimeout(() => {
      alert('–ì—Ä—É –∑–∞–∫—ñ–Ω—á–µ–Ω–æ. –í–∏ –¥–æ–ø—É—Å—Ç–∏–ª–∏ 3 –ø–æ–º–∏–ª–∫–∏.');
      restartGame();
    }, 500);
  } else if (selectedCount === requiredSelections || span.classList.contains('wrong')) {
    document.getElementById('next').style.display = 'inline-block';
  }
}

function updateInfo() {
  document.getElementById('streak').textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –Ω–∞–≥–æ–ª–æ—Å—ñ–≤ –ø—ñ–¥—Ä—è–¥: ${streak}`;
  document.getElementById('mistakes').textContent = `–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫: ${mistakes}/3`;
  const toBeat = bestStreak > streak ? bestStreak - streak : 0;
  document.getElementById('record').textContent = toBeat > 0 ? `–î–æ —Ä–µ–∫–æ—Ä–¥—É –∑–∞–ª–∏—à–∏–ª–æ—Å—å: ${toBeat}` : `–ù–æ–≤–∏–π —Ä–µ–∫–æ—Ä–¥!`;
}

function restartGame() {
  streak = 0;
  mistakes = 0;
  availableWords = [...wordsWithStress];
  usedWords = [];
  updateInfo();
  saveProgress();
  chooseWord();
}

function openStats() {
  const stats = document.getElementById('statsContent');
  stats.innerHTML = `
    <p>–£—Å—å–æ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: ${totalCorrect}</p>
    <p>–£—Å—å–æ–≥–æ –ø–æ–º–∏–ª–æ–∫: ${totalMistakes}</p>
    <p>–ù–∞–π–∫—Ä–∞—â–∞ —Å–µ—Ä—ñ—è: ${bestStreak}</p>
    <h3>–ù–∞–π–ø—Ä–æ–±–ª–µ–º–Ω—ñ—à—ñ —Å–ª–æ–≤–∞:</h3>
    <ul>
      ${Object.entries(mistakeWords).sort((a,b) => b[1]-a[1]).slice(0, 10).map(([word, count]) => `<li>${word}: ${count} –ø–æ–º–∏–ª–æ–∫</li>`).join('')}
    </ul>
  `;
  document.getElementById('statsModal').classList.add('show');
}

function closeStats() {
  document.getElementById('statsModal').classList.remove('show');
}

function toggleTheme() {
  document.body.classList.toggle('day');
  const theme = document.body.classList.contains('day') ? 'day' : 'night';
  document.getElementById('themeToggle').textContent = theme === 'day' ? '‚òÄÔ∏è' : 'üåô';
  saveProgress();
}

document.getElementById('themeToggle').onclick = toggleTheme;
document.getElementById('next').onclick = chooseWord;
document.getElementById('restart').onclick = restartGame;
document.getElementById('stats').onclick = openStats;

// Initialize theme from saved preferences
if (savedData.theme === 'day') {
  document.body.classList.add('day');
  document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
} else {
  document.body.classList.remove('day');
  document.getElementById('themeToggle').textContent = 'üåô';
}

chooseWord();
</script>

</body>
</html>